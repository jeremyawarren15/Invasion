pico-8 cartridge // http://www.pico-8.com
version 36
__lua__
-- main
res=120
num_of_stars=200

function _init()
	ship=make_ship()
	bullets={}
	enemies={}
	stars={}
	init_stars()
	
	add(enemies,make_enemy(60,60,3))
	add(enemies,make_enemy(70,60,3))
	add(enemies,make_enemy(80,60,3))
	add(enemies,make_enemy(90,60,3))
	add(enemies,make_enemy(65,50,4))
	add(enemies,make_enemy(75,50,4))
	add(enemies,make_enemy(85,50,4))
	add(enemies,make_enemy(70,40,5))
	add(enemies,make_enemy(80,40,5))
end

function _update()
	update_stars()
	ship:update()
 handle_shoot()
 update_bullets()
end

function _draw()
	cls(0)
	draw_stars()
	ship:draw()
	draw_bullets()
	draw_enemies()
end

function handle_shoot()
 if btnp(5) then
 	add(bullets,make_bullet(
 		ship.x,
 		ship.y-3,
 		ship.v*2
 	))
 	sfx(0)
 end
end
-->8
-- ship

function make_ship()
	local ship={}
		ship.x=res/2
		ship.y=115
		ship.v=2
		ship.sprite=1
		
		ship.update=function(self)
			if btn(0) then
 			self.x-=self.v
	 		if self.x < 0 then self.x=0 end
 		end
 		if btn(1) then
 			self.x+=self.v
				if self.x > res then self.x=res end
 		end
 		
		end
		
		ship.draw=function(self)
			spr(
				self.sprite,
				self.x,
				self.y
			)
		end

	return ship
end
-->8
-- bullet

function make_bullet(x,y,v)
	local b={}
	b.x=x
	b.y=y
	b.v=v

	-- param is ship
	b.update=function(self)
		if self.y < 0 then
 		del(bullets,self)
		else
	 	self.y-=self.v
 	end
	end
	
	b.draw=function(self)
		spr(2,self.x,self.y)
	end
	
	return b
end

function update_bullets()
	for b in all(bullets) do
		for e in all(enemies) do
			if e:is_hit(b.x,b.y) then
				del(bullets,b)
				del(enemies,e)
			end
		end
		
		b:update()
	end
end

function draw_bullets()
	for b in all(bullets) do
		b:draw()
	end
end
-->8
-- enemy
enemy_progress=0
enemy_rate=0.01

function make_enemy(x,y,s)
	local enemy={}
	enemy.x=x
	enemy.y=y
	enemy.hx=-2
	enemy.hy=0
	enemy.hw=6
	enemy.hh=5
	enemy.sprite=s
	
	enemy.is_hit=function(self,x,y)
		base = self.x+self.hx+get_enemy_offset()
		return
			y==self.y and
			(x>=base and
			x<base+self.hw)
	end
	
	enemy.draw=function(self)
		spr(
			self.sprite,
			self.x+get_enemy_offset(),
			self.y
		)
	end
	
	return enemy
end

function draw_enemies()
	for e in all(enemies) do
		e:draw()
	end
	if enemy_progress >= 1 then
		enemy_progress=0
	end
	enemy_progress+=enemy_rate
end

function get_enemy_offset()
 return 15*sin(enemy_progress)
end
-->8
-- stars
function make_star(anywhere)
	local star={}
	
	star.x=flr(rnd(res))
	star.y=anywhere and flr(rnd(res)) or 0
	star.v=3
	star.color=1
	
	star.update=function(self)
		if star.y > res then
			del(stars,self)
		end
		star.y+=star.v
	end
	
	star.draw=function(self)
	 pset(
	 	self.x,
	 	self.y,
	 	self.color
	 )
	end
	
	return star
end

function update_stars()
	for s in all(stars) do
		s:update()
	end
	if count(stars) < num_of_stars then
			add(stars, make_star(false))
			add(stars, make_star(false))
	end
end

function draw_stars()
	for s in all(stars) do
		s:draw()
	end
end

function init_stars()
	for i=1,num_of_stars/2 do
		add(stars, make_star(true))
	end
end
__gfx__
00000000000880000000000000000000000000000000000000000000000000000000000000aaaa00000000000000000000000000000000000000000000000000
0000000000088000000000000000000000000000000000000000000000000000000000000a9999a0000000000000000000000000000000000000000000000000
0070070000877800000000000220022003300330099009900000000000000000000aa000a997799a000000000000000000000000000000000000000000000000
0007700070877807000aa00000222200003333000099990000000000000aa00000a77a00a977779a000000000000000000000000000000000000000000000000
00077000a098890a000aa0000002200000033000000990000007700000a77a0000a77a00a977779a000000000000000000000000000000000000000000000000
00700700a998899a00000000002ee200003bb300009aa90000000000000aa000000aa000a997799a000000000000000000000000000000000000000000000000
00000000a988889a000000000002200000033000000990000000000000000000000000000a9999a0000000000000000000000000000000000000000000000000
00000000000990000000000000000000000000000000000000000000000000000000000000aaaa00000000000000000000000000000000000000000000000000
__label__
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
111111111111111111111111111111111111111111111111111111111111111aa111111111111111111111111111111111111111111111111111111111111111
111111111111111111111111111111111111111111111111111111111111111aa111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111188111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111188111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111877811111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111171877817111111111111111111111111111111111111111111111111111111111111
111111111111111111111111111111111111111111111111111111111111a198891a111111111111111111111111111111111111111111111111111111111111
111111111111111111111111111111111111111111111111111111111111a998899a111111111111111111111111111111111111111111111111111111111111
111111111111111111111111111111111111111111111111111111111111a988889a111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111199111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111

__sfx__
000100002b5502e5503055032550355503755037550345502e550285501d550155500e55007550025500050000500005000000000000000000000000000000000000000000000000000000000000000000000000
001b000018250192501a2501925018250192501a2501925018250192501a2501925018250192501a250192501e2501f250202501f2501e2501f250202501f2501e2501f250202501f2501e2501f250202501f250
001000002570017000170001800018000190001a0001a0001b0001b0001c0001d0001e0001e000277002770027700277002770027700277002670026700267002670026700257002570025700257002570025700
__music__
03 01424344
02 41424344

